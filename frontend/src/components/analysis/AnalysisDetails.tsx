import React, { useMemo } from 'react';
import { Problem } from '../../types/analysis/Problem';
import AnalysisCharts from './AnalysisCharts';

interface AnalysisDetailsProps {
  problem: Problem;
  loading: boolean;
  error: boolean;  // ëª…í™•í•œ boolean íƒ€ì…ìœ¼ë¡œ ì •ì˜
}

const AnalysisDetails: React.FC<AnalysisDetailsProps> = ({ problem, loading, error }) => {
  // ë¡œë”© ìƒíƒœ ì»´í¬ë„ŒíŠ¸
  const renderLoadingState = () => (
    <div className="flex items-center justify-center p-4">
      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
      <span className="ml-2 font-korean-pixel">ë¶„ì„ ì¤‘...</span>
    </div>
  );

  // ì—ëŸ¬ ìƒíƒœ ì»´í¬ë„ŒíŠ¸
  const renderErrorState = () => (
    <div className="text-red-500 p-4 text-center font-korean-pixel">
      ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
    </div>
  );

  // ì†Œë¹„ í€´ì¦ˆ ì˜¤ë‹µì¸ì§€ í™•ì¸ (ë¬¸ì œ ë¶„ì„ì— "ì†Œë¹„ í€´ì¦ˆ"ë¼ëŠ” ë¬¸êµ¬ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸)
  const isConsumptionQuiz = problem.analysis.includes('ì†Œë¹„ í€´ì¦ˆ') || 
                           problem.weakPoints.some(point => point.includes('ì†Œë¹„ í€´ì¦ˆ'));
                           
  // ê¸ˆìœµ ê³µë¶€ íŒ ëª©ë¡
  const financeTips = [
    // ìƒˆë¡œ ì¶”ê°€ëœ 11ê°œì˜ ìƒì„¸ íŒ
    "ê¸°ì´ˆ ê°œë…ë¶€í„° ì°¨ê·¼ì°¨ê·¼ ì´í•´í•˜ì„¸ìš”. ê¸ˆìœµ ê³µë¶€ë¥¼ ì‹œì‘í•  ë• 'ë³µë¦¬', 'ì¸í”Œë ˆì´ì…˜', 'ìì‚°ê³¼ ë¶€ì±„' ê°™ì€ ê¸°ì´ˆ ê°œë…ì„ ë¨¼ì € ì´í•´í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤. ê¸°ë³¸ ìš©ì–´ì¡°ì°¨ ì œëŒ€ë¡œ ì•Œì§€ ëª»í•œ ìƒíƒœë¡œ ë³µì¡í•œ íˆ¬ìë‚˜ ê¸ˆìœµìƒí’ˆì— ì ‘ê·¼í•˜ë©´, í—·ê°ˆë¦¬ê¸° ì‰½ê³  ì‹¤ìˆ˜ë„ ì¦ì•„ì ¸ìš”. ìš©ì–´ í•˜ë‚˜í•˜ë‚˜ë¥¼ ì‚¬ì „ì²˜ëŸ¼ ì •ë¦¬í•´ë‘ê±°ë‚˜, ë¨¸ë¦¿ì†ì—ì„œ íë¦„ìœ¼ë¡œ ì—°ê²°í•˜ëŠ” ì—°ìŠµì„ í•´ë³´ì„¸ìš”.",
    "ì‚¬ë¡€ ì¤‘ì‹¬ìœ¼ë¡œ ì‹œì‚¬ ì´ìŠˆë¥¼ ì ‘í•´ë³´ì„¸ìš”. ê¸ˆìœµì€ í˜„ì‹¤ê³¼ ë§ë‹¿ì•„ ìˆëŠ” ë¶„ì•¼ë¼, í˜„ì¬ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§€ê³  ìˆëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ ê³µë¶€ê°€ ìƒìƒí•´ì§‘ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 'ê¸°ì¤€ê¸ˆë¦¬ ì¸ìƒ'ì´ë¼ëŠ” ë‰´ìŠ¤ë¥¼ ë³´ë©´, ì™œ ì‹œì¥ì´ í”ë“¤ë¦¬ëŠ”ì§€, ë‚˜ì˜ ì˜ˆì ê¸ˆì—” ì–´ë–¤ ì˜í–¥ì´ ìˆì„ì§€ë¥¼ ì—°ê²°í•´ë³´ëŠ” ê²ƒì´ì£ .",
    "ì‹¤ìƒí™œì— ì ìš©í•˜ë©° ë°˜ë³µ í•™ìŠµí•˜ì„¸ìš”. ê³µë¶€í•œ ë‚´ìš©ì„ ë°”ë¡œ ì‹¤ìƒí™œì— ì ìš©í•´ë³´ëŠ” ê²ƒì´ ê°€ì¥ í™•ì‹¤í•œ ë³µìŠµì´ì ì²´í™” ë°©ë²•ì´ì—ìš”. ì˜ˆë¥¼ ë“¤ì–´, ì¹´ë“œ ëª…ì„¸ì„œì˜ ì´ììœ¨, ì€í–‰ ì•±ì˜ ì˜ˆì ê¸ˆ ê¸ˆë¦¬, ëŒ€ì¶œ ìƒí’ˆ ë¹„êµ ë“±ì„ ì§ì ‘ í•´ë³´ë©° ì‹¤ì „ ê°ê°ì„ ìµí ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    "í•µì‹¬ ê°œë…ì„ ì •ë¦¬í•˜ê³  ë³µìŠµí•˜ì„¸ìš”. ê¸ˆìœµ ìš©ì–´ë‚˜ ê°œë…ì€ ë°˜ë³µí•˜ì§€ ì•Šìœ¼ë©´ ê¸ˆì„¸ ìŠíˆê¸° ë•Œë¬¸ì—, ì§§ê²Œë¼ë„ ìì£¼ ë³µìŠµí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”. ë…¸íŠ¸ë¥¼ ë§Œë“¤ì–´ í•µì‹¬ ê°œë…ì„ í•œ ì¤„ ìš”ì•½í•˜ê³ , ì˜†ì— ê´€ë ¨ ì˜ˆì‹œë‚˜ ì‹¤ì œ ë‰´ìŠ¤ ì‚¬ë¡€ë¥¼ ì ì–´ë³´ëŠ” ë°©ì‹ì´ ì¢‹ì•„ìš”.",
    "ì‹¤ì œ ê¸ˆìœµ ë‰´ìŠ¤ì—ì„œ ë°°ìš´ ë‚´ìš©ì„ ì°¾ì•„ë³´ì„¸ìš”. ê¸ˆìœµ ê°œë…ì„ ìµíŒ ë’¤ì—ëŠ”, ê·¸ê²ƒì´ ì‹¤ì œ ì‹œì¥ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ë¥¼ ì§ì ‘ í™•ì¸í•´ë³´ëŠ” ê²Œ ì •ë§ ì¤‘ìš”í•´ìš”. ì˜ˆë¥¼ ë“¤ì–´ 'ê¸ˆë¦¬ê°€ ì¸ìƒë˜ë©´ ì±„ê¶Œ ê°€ê²©ì´ ë–¨ì–´ì§„ë‹¤'ëŠ” ê°œë…ì„ ì•Œê²Œ ë˜ì—ˆë‹¤ë©´, ê´€ë ¨ ë‰´ìŠ¤ ê¸°ì‚¬ì—ì„œ ê·¸ëŸ° ì‚¬ë¡€ë¥¼ ì°¾ì•„ë³´ëŠ” ê±°ì£ .",
    "ê¸ˆìœµ ì½˜í…ì¸ ë¥¼ ê¾¸ì¤€íˆ ë“¤ì–´ë³´ì„¸ìš”. ê¸ˆìœµ ìœ íŠœë¸Œ, íŒŸìºìŠ¤íŠ¸, ì˜¤ë””ì˜¤ë¶ì€ ê³µë¶€ì— ì§€ë£¨í•¨ì„ ëŠë‚„ í‹ˆì„ ì¤„ì—¬ì£¼ëŠ” í›Œë¥­í•œ ë„êµ¬ì˜ˆìš”. íŠ¹íˆ ì¶œí‡´ê·¼ ì‹œê°„, ìš´ë™í•  ë•Œ, ì„¤ê±°ì§€í•˜ê±°ë‚˜ ì •ë¦¬í•  ë•Œ í‹€ì–´ë†“ê¸°ë§Œ í•´ë„ ê·€ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìµìˆ™í•´ì§‘ë‹ˆë‹¤.",
    "ê°€ê³„ë¶€ë¡œ ëˆì˜ íë¦„ì„ ì§ì ‘ ì²´ê°í•´ë³´ì„¸ìš”. ê°€ê³„ë¶€ë¥¼ ì“°ëŠ” ê±´ ë‹¨ìˆœí•œ ê¸°ë¡ì´ ì•„ë‹ˆë¼, ë‚˜ì˜ 'ì¬ë¬´ ìƒíƒœ'ë¥¼ ëˆˆìœ¼ë¡œ í™•ì¸í•˜ê³  ê´€ë¦¬í•˜ëŠ” í›ˆë ¨ì…ë‹ˆë‹¤. ë‚´ê°€ ì–´ë””ì— ê°€ì¥ ë§ì´ ì“°ê³  ìˆëŠ”ì§€, ê³ ì •ì§€ì¶œê³¼ ë³€ë™ì§€ì¶œì€ ì–´ë–»ê²Œ êµ¬ì„±ë¼ ìˆëŠ”ì§€ë¥¼ íŒŒì•…í•´ë³´ì„¸ìš”.",
    "ì‘ê²Œ ìª¼ê°œì„œ í•œ ì£¼ì œì”© ì§‘ì¤‘í•˜ì„¸ìš”. ê¸ˆìœµì€ ë²”ìœ„ê°€ ë„“ê³  ìš©ì–´ë„ ë§ì•„ì„œ, ì²˜ìŒì—” ë§‰ë§‰í•  ìˆ˜ ìˆì–´ìš”. ì´ëŸ´ ë• í•˜ë£¨ì— í•œ ì£¼ì œì”©ë§Œ ê³µë¶€í•´ë³´ëŠ” ê²Œ ì¢‹ì•„ìš”. ì˜ˆë¥¼ ë“¤ì–´ ì˜¤ëŠ˜ì€ 'ì˜ˆê¸ˆê³¼ ì ê¸ˆì˜ ì°¨ì´', ë‚´ì¼ì€ 'ì‹ ìš©ì¹´ë“œì˜ ì´ì êµ¬ì¡°', ëª¨ë ˆëŠ” 'ETFë€ ë¬´ì—‡ì¸ê°€'ì²˜ëŸ¼ìš”.",
    "ëª¨ì˜íˆ¬ìë¡œ ì‹œì¥ì˜ íë¦„ì„ ìµí˜€ë³´ì„¸ìš”. ì‹¤ì œë¡œ ëˆì„ ê±¸ì§€ ì•Šì•„ë„, ìš”ì¦˜ì€ ë‹¤ì–‘í•œ ëª¨ì˜íˆ¬ì í”Œë«í¼ì´ ìˆì–´ì„œ ê°€ìƒìœ¼ë¡œ íˆ¬ì ê²½í—˜ì„ ìŒ“ì„ ìˆ˜ ìˆì–´ìš”. ì£¼ì‹, ì±„ê¶Œ, ETF, í€ë“œ ë“±ì„ ê°€ìƒìœ¼ë¡œ ì‚¬ê³ íŒ”ë©° ì‹œì¥ì˜ íë¦„ì„ ì§ì ‘ ì²´í—˜í•´ë³¼ ìˆ˜ ìˆì£ .",
    "ì¬í…Œí¬ ì±… í•œ ê¶Œì„ ëê¹Œì§€ ì½ì–´ë³´ì„¸ìš”. ì •ë³´ê°€ ë„˜ì³ë‚˜ëŠ” ì‹œëŒ€ì§€ë§Œ, ê¹Šì´ ìˆëŠ” ì´í•´ë¥¼ ìœ„í•´ì„œëŠ” ì±…ë§Œí¼ ì¢‹ì€ ìë£Œê°€ ì—†ì–´ìš”. íŠ¹íˆ ì…ë¬¸ì„œ í•œ ê¶Œì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì •ë…í•˜ëŠ” ê²½í—˜ì€ ê¸ˆìœµ ê³µë¶€ì˜ ê¸°ì¤€ì ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.",
    "ê²½ì œ ì‹ ë¬¸ì´ë‚˜ ë‰´ìŠ¤ ì•±ìœ¼ë¡œ íë¦„ì„ ì²´í¬í•˜ì„¸ìš”. ë§¤ì¼ ì•„ì¹¨ ê²½ì œ ë‰´ìŠ¤ í•œ ê¼­ì§€ë§Œì´ë¼ë„ ì½ëŠ” ìŠµê´€ì€ ê¸ˆìœµ ê°ê°ì„ ë¹ ë¥´ê²Œ í‚¤ì›Œì£¼ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ëª¨ë“  ê¸°ì‚¬ë¥¼ ë‹¤ ì½ì„ í•„ìš”ëŠ” ì—†ê³ , í—¤ë“œë¼ì¸ê³¼ ìš”ì•½ì„ í†µí•´ íë¦„ë§Œì´ë¼ë„ ì¡ì•„ë³´ì„¸ìš”.",
  ];
  
  // ëœë¤í•˜ê²Œ íŒ ì„ íƒ (ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ useMemo ì‚¬ìš©)
  const randomTip = useMemo(() => {
    if (!isConsumptionQuiz) return null;
    const randomIndex = Math.floor(Math.random() * financeTips.length);
    return financeTips[randomIndex];
  }, [isConsumptionQuiz, problem.id]); // problem.idë¥¼ ì˜ì¡´ì„± ë°°ì—´ì— ì¶”ê°€í•˜ì—¬ ë¬¸ì œê°€ ë°”ë€” ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ íŒì´ ì„ íƒë˜ë„ë¡ í•¨

  if (loading) {
    return renderLoadingState();
  }

  if (error) {
    return renderErrorState();
  }

  return (
    <div className="space-y-6">
      <div>
        <h4 className="font-korean-pixel text-lg text-gray-800 mb-4">{problem.title}</h4>
        <AnalysisCharts problem={problem} />
      </div>
      <div className="mt-6">
        <h5 className="font-korean-pixel text-gray-800 mb-2">ğŸ“Š ë¶„ì„ ë‚´ìš©</h5>
        <p className="font-korean-pixel text-gray-600 whitespace-pre-line">{problem.analysis}</p>
      </div>
      <div>
        {/* <h5 className="font-korean-pixel text-gray-800 mb-2">ğŸ’¡ ì·¨ì•½ì </h5> */}
        <ul className="list-disc pl-5 space-y-1">
        </ul>
      </div>
      <div>
        {/* <h5 className="font-korean-pixel text-gray-800 mb-2">âœ¨ ì¶”ì²œ í•™ìŠµ</h5> */}
        <ul className="list-disc pl-5 space-y-1">
        </ul>
      </div>
      
      {/* ê¸ˆìœµ ê³µë¶€ ì¡°ì–¸ ì„¹ì…˜ - ì†Œë¹„ í€´ì¦ˆ ì˜¤ë‹µì¼ ë•Œë§Œ í‘œì‹œ */}
      {isConsumptionQuiz && randomTip && (
        <div className="mt-4">
          <p className="font-korean-pixel text-gray-700">
            {randomTip}
          </p>
        </div>
      )}
    </div>
  );
};

export default AnalysisDetails;